<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title> نصب Galer Cluster بر روی debian8 - دست نوشته های یک تازه کار </title>
    <meta name="description" content="Galer Cluster یک برنامه کلاستر همزمان چند سرور master برمبنای replication همزمان می باشد."/>
    <meta name="keywords" content=" linux, debian, galera, mariadb, cluster" />

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <!-- link href="style/bootstrap/css/bootstrap.css" rel="stylesheet" crossorigin="anonymous" -->

    <link href="https://rawgit.com/richleland/pygments-css/master/github.css" rel="stylesheet" crossorigin="anonymous">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
    body {
      direction: rtl;
    }
    p {
        font-size: 1.3em;
        line-height: 1.5em;
        text-align: justify;
      }
  pre {
        direction: ltr;
        border-left: 5px solid #6ce26c;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header navbar-right">
          <a class="navbar-brand" href="/">دست نوشته های یک تازه کار</a>
        </div>
        <ul class="nav navbar-nav navbar-right">
            
                
                    <li><a href="/about.html" title="درباره ما">درباره ما</a></li>
                
                    <li><a href="/contacus.html" title="ارتباط با ما">ارتباط با ما</a></li>
                
                    <li><a href="http://shgn.ir/tag/linux.html" title="linux">linux</a></li>
                
                    <li><a href="http://shgn.ir/yii2/" title="معرفی Yii2">معرفی Yii2</a></li>
                
            
          </ul>
      </div>
    </nav>

    <div class="container">
      <div class="row">
        <div class="col-md-9">
            
    <div itemscope itemtype="http://schema.org/NewsArticle">
    <meta itemscope itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" itemid="http://shgn.ir/2017-08-16/galera_cluster.html"/>
    <div class="page-header">
      <h3 itemprop="name">نصب Galer Cluster بر روی debian8</h3>
      
      
        <small>
          <p class="text-right">
            ارسال شده <span itemprop="author" itemscope itemtype="https://schema.org/Person">
                توسط <span itemprop="name">سید سجاد شاهچراغیان</span>
              </span>
              در تاریخ <span itemprop="datePublished">2017-08-16</span>
          </p>
        </small>
      
    </div>
      <section itemprop="articleBody">
        <p>برنامه Galera Cluster یک برنامه متن باز و رایگان clustering چند سرور به صورت Master با replication همزمان بر روی آنها در بستر MariDB می باشد. این نوع از کلاسترینگ فقط بر روی لینوکس قابل پیاده سازی بوده و فقط از موتور ذخیره سازی دیتابیس XtraDB یا InnoDB حمایت می کند. کار کردن با MariaDB ۱۰.۱، به طور پیش فرض wsrep API این کلاسترینگ در MariaDB درون سازی شده است.</p>
<p>برای نصب Galera Cluster، نیاز به دریافت و نصب آن به صورت جداگانه نمی باشد. در نسخه های جدید، این برنامه به همراه برنامه <code>mariadb-server</code> نصب می شود. باید دقت شود که فلسفه کاری Galera Cluster بر مبنای تعداد نود های فرد می باشد، بنابراین، برای ۳ نود توضیحات ارائه شده و در هرجا که کدها تکی بود، باید بر روی هر سه نود به طور همسان اجرا شوند.</p>
<h3>مراحل نصب</h3>
<p>مراحل نصب بر روی دبیان8:</p>
<pre class="codehilite"><code>$ sudo apt-get install software-properties-common
$ sudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8
$ sudo add-apt-repository 'deb [arch=amd64,i386] http://mirror.mephi.ru/mariadb/repo/10.1/debian jessie main'
$ apt-get update

$ sudo apt-get install mariadb-server rsync</code></pre>


<p>پس از نصب بسته ها لازم است تا فایل تنظیمات مربوط به راه اندازی کلاسترینگ ایجاد شود:</p>
<pre class="codehilite"><code>$ sudo vi /etc/mysql/conf.d/galera.cnf</code></pre>


<p>در فایل ایجاد شده باید پارامترهای زیر برای سرور <strong>اول</strong> اضافه و ذخیره شوند:</p>
<pre class="codehilite"><code>[mysqld]
#mysql settings
binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
query_cache_size=0
query_cache_type=0
innodb_flush_log_at_trx_commit=2
innodb_buffer_pool_size=7G
bind-address=192.168.205.32

#Galera settings
wsrep_provider=&quot;/usr/lib/galera/libgalera_smm.so&quot;
wsrep_cluster_name=&quot;ahenart_cluster-BAD&quot;
wsrep_cluster_address=&quot;gcomm://192.168.205.32,192.168.205.31,192.168.205.33&quot;
wsrep_sst_method=rsync
wsrep_on=ON
wsrep_node_address=&quot;192.168.205.32&quot;
wsrep_node_name=&quot;db12-rt&quot;
&lt;/code&gt;</code></pre>


<p>در فایل ایجاد شده باید پارامترهای زیر برای سرور <strong>دوم</strong> اضافه و ذخیره شوند:</p>
<pre class="codehilite"><code>[mysqld]
#mysql settings
binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
query_cache_size=0
query_cache_type=0
innodb_flush_log_at_trx_commit=2
innodb_buffer_pool_size=7G
bind-address=192.168.205.33

#Galera settings
wsrep_provider=&quot;/usr/lib/galera/libgalera_smm.so&quot;
wsrep_cluster_name=&quot;ahenart_cluster-BAD&quot;
wsrep_cluster_address=&quot;gcomm://192.168.205.32,192.168.205.31,192.168.205.33&quot;
wsrep_sst_method=rsync
wsrep_on=ON
wsrep_node_address=&quot;192.168.205.33&quot;
wsrep_node_name=&quot;db22-rt&quot;

در فایل ایجاد شده باید پارامترهای زیر برای سرور **سوم** اضافه و ذخیره شوند:

[mysqld]
#mysql settings
binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
query_cache_size=0
query_cache_type=0
innodb_flush_log_at_trx_commit=2
innodb_buffer_pool_size=7G
bind-address=192.168.205.31

#Galera settings
wsrep_provider=&quot;/usr/lib/galera/libgalera_smm.so&quot;
wsrep_cluster_name=&quot;ahenart_cluster-BAD&quot;
wsrep_cluster_address=&quot;gcomm://192.168.205.32,192.168.205.31,192.168.205.33&quot;
wsrep_sst_method=rsync
wsrep_on=ON
wsrep_node_address=&quot;192.168.205.31&quot;
wsrep_node_name=&quot;db32-rt&quot;</code></pre>


<h3>راه اندازی گلرا کلاستر</h3>
<p><strong>برای راه اندزای گلرا کلاستر برای اول مرتبه باید به ترتیب زیر عمل نمود.</strong></p>
<p><em>1</em> قبل از هر کاری بر روی هر سه سرور باید سرویس <code>mysql</code> متوقف شود:</p>
<pre class="codehilite"><code>$ sudo service mysql stop</code></pre>


<p><em>2</em> سپس سروری که قرار است اولین نود تعیین شود به این صورت راه اندازی می شود:</p>
<pre class="codehilite"><code>$ sudo galera_new_cluster</code></pre>


<p>یا</p>
<pre class="codehilite"><code>$ sudo /usr/bin/galera_new_cluster</code></pre>


<p><em>3</em> جهت اطمینان از اجرای کلاسترینگ بر روی اولین نود:</p>
<pre class="codehilite"><code>$ sudo ps aux | grep mysql</code></pre>


<p>که باید نتیجه زیر مشاهده شود:</p>
<pre class="codehilite"><code>mysql 10587 14.0 15.5 1266120 155268 ? Ssl 01:50 0:00 /usr/sbin/mysqld --wsrep-new-cluster --wsrep_start_position=00000000-0000-0000-0000-000000000000:-1
root 20822 0.0 0.0 12948 980 pts/0 S+ 01:22 0:00 grep --color=auto mysql&lt;/code&gt;</code></pre>


<p><em>4</em> جهت الحاق نود های دوم و سوم به کلاسترینگ و فقط کافی است تا سرویس آن راه اندازی شود:</p>
<pre class="codehilite"><code>$ sudo service mysql start</code></pre>


<p>در این زمان هر سه نود گلرا کلاسترینگ راه اندازی و در حال اجرا می باشند. برای اطمینان از این موضوع می توان دستور زیر را بر روی هر سه نود گلرا اجرا و نتیجه را مشاهده نمود:</p>
<pre class="codehilite"><code>$ mysql -u root -p -e &quot;SHOW STATUS LIKE 'wsrep_cluster_size';&quot;
Enter password:
+--------------------+-------+
| Variable_name      | Value |
+--------------------+-------+
| wsrep_cluster_size | 3     |
+--------------------+-------+</code></pre>


<h3>منابع</h3>
<ul>
<li><a href="https://www.cyberciti.biz/faq/howto-install-configure-mariadb-galera-master-cluster-ubuntulinux/">howto-install-configure-mariadb-galera-master-cluster-ubuntulinux</a></li>
<li><a href="http://galeracluster.com/documentation-webpages/mysqlwsrepoptions.html">MySQL wsrep Options</a></li>
<li><a href="https://mariadb.com/kb/en/mariadb/galera-cluster-system-variables/">Galera Cluster System Variables</a></li>
</ul>
      </section>
      <div>
        برچسب ها:
      
        <a href="/tag/linux.html">
            <span class="label label-default" itemprop="about">linux</span>
        </a>
      
        <a href="/tag/debian.html">
            <span class="label label-default" itemprop="about">debian</span>
        </a>
      
        <a href="/tag/galera.html">
            <span class="label label-default" itemprop="about">galera</span>
        </a>
      
        <a href="/tag/mariadb.html">
            <span class="label label-default" itemprop="about">mariadb</span>
        </a>
      
        <a href="/tag/cluster.html">
            <span class="label label-default" itemprop="about">cluster</span>
        </a>
      
    </div>
    </div>

        </div>
        <div class="col-md-3">
          <div class="panel-group">
            <div class="panel panel-primary">
              <div class="panel-heading">
                من در stackexchange.com
              </div>
              <div class="panel-body">
                <div class="col-md-3 col-md-offset-9">
                  <a href="http://stackexchange.com/users/887576" target="_blank">
                    <img src="http://stackexchange.com/users/flair/887576.png" width="208" height="58" alt="profile for shgnInc on Stack Exchange, a network of free, community-driven Q&A sites" title="profile for shgnInc on Stack Exchange, a network of free, community-driven Q&A sites">
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <footer>
      <div class="container">
        <div class="row">
            <div class="col-md-6">
              
              <strong>پیشنهادی های</strong>
              <ul>
                
                    <li><a href="https://github.com/shgninc">GitHub</a></li>
                
                    <li><a href="http://google.com">Google</a></li>
                
              </ul>
              
            </div>
            <div class="col-md-6">
              <strong>دسترسی های ساده</strong>
              <ul>
                <li><a href="/">تمامی پست ها</a></li>
                <li><a href="/tags.html">فهرست تگ ها</a></li>
              </ul>
            </div>
            <div class="col-md-12">
              <p class="text-center"><small>shgn.ir &copy; 2015</small></p>
            </div>
        </div>
      </div>
    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha256-KXn5puMvxCw+dAYznun+drMdG1IFl3agK0p/pqT9KAo= sha512-2e8qq0ETcfWRI4HJBzQiA3UoyFk6tbNyG+qSaIBZLyW9Xf3sWZHN/lxe9fTh1U45DpPf07yj94KsUHHWe4Yk1A==" crossorigin="anonymous"></script>
  </body>
</html>